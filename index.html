<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Membership Card — QR Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --gold:#c59d2f; /* formal gold */
      --deep-blue:#0b3d91;
      --accent-red:#c62828;
      --card-width:640px;
      --card-height:400px;
      --pad:20px;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    body{display:flex;gap:30px;align-items:flex-start;justify-content:center;padding:36px;background:#f3f6fb;color:#111}

    /* form */
    .panel{width:360px;background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(10,20,40,0.08)}
    .panel h2{margin:0 0 10px;font-size:18px;color:var(--deep-blue)}
    label{display:block;margin-top:12px;font-size:13px;color:#444}
    input[type=text]{width:100%;padding:10px;border:1px solid #e1e6f0;border-radius:8px;font-size:14px}
    .row{display:flex;gap:10px}
    button{margin-top:14px;background:var(--deep-blue);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:transparent;color:var(--deep-blue);border:1px solid #d6def9}

    /* card preview */
    .preview-wrap{width:var(--card-width)}
    .card{width:var(--card-width);height:var(--card-height);border-radius:14px;border:6px solid var(--gold);background:linear-gradient(180deg,#ffffff 0%, #f7fbff 100%);box-shadow:0 12px 30px rgba(10,20,40,0.1);position:relative;padding:22px;box-sizing:border-box}
    .card .brand{display:flex;align-items:center;gap:12px}
    .logo-flag{width:72px;height:72px;border-radius:10px;background:linear-gradient(135deg,var(--deep-blue),var(--accent-red));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}
    .org{font-weight:700;color:var(--deep-blue);font-size:18px}
    .org-sub{font-size:12px;color:#4b5666}

    .card-body{display:flex;gap:18px;margin-top:18px}
    .left{flex:1}
    .field{font-size:13px;color:#4b5566;margin-bottom:8px}
    .value{font-size:18px;color:#0e1630;font-weight:600}

    .qr-wrap{width:170px;height:170px;background:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center;padding:8px;border:1px solid #e6eef8}
    .small-meta{position:absolute;right:12px;bottom:12px;font-size:11px;color:#51607a}

    /* responsive */
    @media (max-width:980px){body{flex-direction:column;align-items:center} .preview-wrap{width:90%} .panel{width:90%}}
  </style>
</head>
<body>
  <div class="panel">
    <h2>Membership Card — Generator</h2>
    <div style="font-size:13px;color:#556;">Enter member info below. The QR will contain all the data as a JSON string.</div>

    <label for="fullname">Full name</label>
    <input id="fullname" type="text" placeholder="Juan Dela Cruz" value="">

    <label for="idnum">ID number</label>
    <input id="idnum" type="text" placeholder="ABC-2025-001" value="">

    <div style="display:flex;gap:10px;align-items:center">
      <button id="genBtn">Generate Card & QR</button>
      <button id="downloadBtn" class="secondary" disabled>Download PNG</button>
    </div>

    <div style="margin-top:14px;font-size:12px;color:#667">Notes: QR contains all entered fields. Open the download to get a PNG image of the card.</div>
  </div>

  <div class="preview-wrap">
    <div id="card" class="card" aria-hidden="true">
      <div class="brand">
        <div class="logo-flag">SAM</div>
        <div>
          <div class="org">SAMAGFIL PRINT</div>
          <div class="org-sub">Official Membership Card</div>
        </div>
      </div>

      <div class="card-body">
        <div class="left">
          <div style="margin-top:6px">
            <div class="field">Full name</div>
            <div id="cName" class="value">—</div>
          </div>

          <div style="margin-top:12px">
            <div class="field">ID number</div>
            <div id="cID" class="value">—</div>
          </div>

          <div style="margin-top:18px;color:#4b5566;font-size:12px">Issued: <span id="issuedDate"></span></div>
        </div>

        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center">
          <div id="qrcode" class="qr-wrap"></div>
          <div style="margin-top:8px;font-size:12px;color:#556">Scan for member data</div>
        </div>
      </div>

      <div class="small-meta">Valid ID — Keep for verification</div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    // elements
    const fullname = document.getElementById('fullname');
    const idnum = document.getElementById('idnum');
    const genBtn = document.getElementById('genBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const cName = document.getElementById('cName');
    const cID = document.getElementById('cID');
    const issuedDate = document.getElementById('issuedDate');
    const qrcodeEl = document.getElementById('qrcode');
    const cardEl = document.getElementById('card');

    let qrcodeInstance = null;

    function formatDate(d){
      const dt = new Date(d);
      return dt.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
    }

    function generateQRCode(payloadText){
      // clear
      qrcodeEl.innerHTML = '';
      // create QR code (size fits inside qr-wrap)
      qrcodeInstance = new QRCode(qrcodeEl, {
        text: payloadText,
        width: 140,
        height: 140,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
n      });
    }

    genBtn.addEventListener('click', ()=>{
      const name = (fullname.value || '').trim();
      const id = (idnum.value || '').trim();
      if(!name || !id){
        alert('Please enter both Full name and ID number.');
        return;
      }

      // fill card
      cName.textContent = name;
      cID.textContent = id;
      issuedDate.textContent = formatDate(new Date());

      // create payload (JSON string holding all member info)
      const payload = {
        fullName: name,
        idNumber: id,
        issued: (new Date()).toISOString()
      };

      const payloadText = JSON.stringify(payload);
      generateQRCode(payloadText);

      downloadBtn.disabled = false;
    });

    downloadBtn.addEventListener('click', async ()=>{
      // use html2canvas to capture the card area
      downloadBtn.disabled = true;
      downloadBtn.textContent = 'Preparing...';
      try{
        const canvas = await html2canvas(cardEl, {scale:2, backgroundColor:null});
        // convert to PNG
        const dataUrl = canvas.toDataURL('image/png');
        // create link and download
        const a = document.createElement('a');
        a.href = dataUrl;
        const nameSafe = (fullname.value || 'member').replace(/[^a-z0-9-_]/ig,'_');
        a.download = `${nameSafe}_membership_card.png`;
        document.body.appendChild(a);
        a.click();
        a.remove();
      }catch(err){
        console.error(err);
        alert('Failed to prepare download — try again.');
      }
      downloadBtn.textContent = 'Download PNG';
      downloadBtn.disabled = false;
    });
  </script>
</body>
</html>
